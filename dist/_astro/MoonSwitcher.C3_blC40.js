import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.CQ95-tCy.js";function N(t){let o=(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),12,0,0)/864e5+24405875e-1-24515501e-1)/29.530588853;o=o-Math.floor(o);const i=o*2*Math.PI,d=.5*(1-Math.cos(i));return{phase:o,fraction:d,angle:i}}function C(t){const n=(t%1+1)%1;return n<.03||n>=.97?0:n<.22?1:n<.28?2:n<.47?3:n<.53?4:n<.72?5:n<.78?6:7}const y=["Luna nueva","Creciente iluminante","Cuarto creciente","Gibosa creciente","Luna llena","Gibosa menguante","Cuarto menguante","Creciente menguante"],T=["/nueva.png","/creciente.png","/ccreciente.png","/gcreciente.png","/llena.png","/gmenguante.png","/cmenguante.png","/menguante.png"];function D({messages:t}){const[n,r]=l.useState(()=>{const s=new Date,p=s.getFullYear(),m=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");return`${p}-${m}-${c}`}),{label:a,fraction:u,phaseVal:o,idx:i}=l.useMemo(()=>{const s=new Date(`${n}T12:00:00`);if(Number.isNaN(s.getTime()))return{label:"Fecha inválida",fraction:0,phaseVal:0,idx:0};const p=N(s),m=C(p.phase);return{label:(t?.phaseNames||y)[m]||y[m],fraction:p.fraction,phaseVal:p.phase,idx:m}},[n,t]),d=l.useRef(null),[x,f]=l.useState(140);l.useEffect(()=>{const s=()=>{const p=d.current?.offsetWidth||window.innerWidth||360,m=p<420?110:p<560?130:p<820?140:160;f(m)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const b=Math.round(100*u);return e.jsxs("div",{ref:d,className:"mpb",style:{display:"grid",gap:12},children:[e.jsxs("label",{className:"mpb-field",style:{fontWeight:600},children:[t?.dateLabel||"Fecha",e.jsx("input",{type:"date",value:n,onChange:s=>r(s.target.value),style:{marginLeft:8}})]}),e.jsxs("div",{className:"mpb-row",style:{display:"flex",alignItems:"center",gap:16,flexWrap:"wrap"},children:[e.jsx("img",{src:T[i],width:x,height:x,alt:a,style:{borderRadius:"50%",boxShadow:"0 8px 24px rgba(0,0,0,.35), inset 0 2px 8px rgba(255,255,255,.08)",background:"#0b1020"},onError:s=>{s.currentTarget.src.endsWith("moon-texture.svg")||(s.currentTarget.src="/moon-texture.svg")}}),e.jsxs("div",{className:"mpb-info",style:{minWidth:220,flex:"1 1 240px"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:a}),e.jsxs("div",{children:[t?.illumination||"Iluminación"," : ",b,"%"]}),e.jsxs("div",{children:["phase 0–1: ",o.toFixed(3)]})]})]}),e.jsx("small",{style:{opacity:.8},children:t?.note||"Nota: aproximación visual; puede variar ±1 día según efemérides y zona horaria."})]})}function v(t){let o=(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),12,0,0)/864e5+24405875e-1-24515501e-1)/29.530588853;o=o-Math.floor(o);const i=o*2*Math.PI,d=.5*(1-Math.cos(i));return{phase:o,fraction:d}}function _(t,n){const r=(t%1+1)%1,a=n||["Luna nueva","Creciente iluminante","Cuarto creciente","Gibosa creciente","Luna llena","Gibosa menguante","Cuarto menguante","Creciente menguante"];return r<.03||r>=.97?a[0]:r<.22?a[1]:r<.28?a[2]:r<.47?a[3]:r<.53?a[4]:r<.72?a[5]:r<.78?a[6]:a[7]}function j(t){const n=(t%1+1)%1;return n<.03||n>=.97?0:n<.22?1:n<.28?2:n<.47?3:n<.53?4:n<.72?5:n<.78?6:7}const w=["/nueva.png","/creciente.png","/ccreciente.png","/gcreciente.png","/llena.png","/gmenguante.png","/cmenguante.png","/menguante.png"];function M({phase:t,fraction:n,label:r}){const a=l.useMemo(()=>j(t),[t]),u=Math.round(n*100);return e.jsxs("figure",{className:"moonimg",style:{textAlign:"center"},children:[e.jsx("img",{src:w[a],alt:r,width:180,height:180,style:{borderRadius:"50%",boxShadow:"0 8px 24px rgba(0,0,0,.35), inset 0 2px 8px rgba(255,255,255,.08)",background:"#0b1020"},onError:o=>{o.currentTarget.src.endsWith("moon-texture.svg")||(o.currentTarget.src="/moon-texture.svg")}}),e.jsxs("figcaption",{children:[e.jsx("div",{className:"moonimg__label",style:{fontWeight:700,marginTop:".35rem"},children:r}),e.jsxs("div",{className:"moonimg__meta",style:{fontVariantNumeric:"tabular-nums",opacity:.85},children:[u,"%"]})]}),e.jsx("style",{jsx:!0,children:`
        @media (max-width: 560px){ .moonimg img{ width: 140px; height: 140px; } }
      `})]})}function A({messages:t}){const n=l.useMemo(()=>{const c=new Date,h=c.getFullYear(),g=String(c.getMonth()+1).padStart(2,"0"),S=String(c.getDate()).padStart(2,"0");return`${h}-${g}-${S}`},[]),[r,a]=l.useState(n),[u,o]=l.useState(n),i=l.useMemo(()=>{const c=new Date(`${r}T12:00:00`),{phase:h,fraction:g}=v(c);return{phase:h,fraction:g,label:_(h,t?.phaseNames)}},[r,t]),d=l.useMemo(()=>{const c=new Date(`${u}T12:00:00`),{phase:h,fraction:g}=v(c);return{phase:h,fraction:g,label:_(h,t?.phaseNames)}},[u,t]),x=Math.min(Math.abs(i.phase-d.phase),1-Math.abs(i.phase-d.phase)),f=Math.round((1-x*2)*100),b=Math.min(100,Math.round((i.fraction+d.fraction)*100)),[s,p]=l.useState({srcA:"",srcB:"",visible:!1}),m=()=>{const c=j(i.phase),h=j(d.phase);p({srcA:w[c],srcB:w[h],visible:!0})};return e.jsxs("div",{className:"mooncouple",children:[e.jsxs("div",{className:"mooncouple__controls",children:[e.jsxs("label",{children:[t?.dateA||"Persona 1",e.jsx("input",{type:"date",value:r,onChange:c=>a(c.target.value)})]}),e.jsxs("label",{children:[t?.dateB||"Persona 2",e.jsx("input",{type:"date",value:u,onChange:c=>o(c.target.value)})]})]}),e.jsxs("div",{className:"mooncouple__grid",children:[e.jsx("div",{className:"mooncard",children:e.jsx(M,{phase:i.phase,fraction:i.fraction,label:i.label})}),e.jsx("div",{className:"mooncard",children:e.jsx(M,{phase:d.phase,fraction:d.fraction,label:d.label})})]}),e.jsxs("div",{className:"mooncouple__match",children:[t?.match||"Concordancia",": ",e.jsxs("strong",{children:[f,"%"]})," · ",t?.combined||"Combinada",": ",e.jsxs("strong",{children:[b,"%"]})]}),e.jsx("div",{className:"mooncouple__actions",children:e.jsx("button",{type:"button",className:"btn",onClick:m,children:t?.compareCta||"Comparar"})}),s.visible&&e.jsx("div",{className:"mooncouple__result",children:e.jsxs("div",{className:"overlay-moon","aria-label":t?.combined||"Combinada",children:[e.jsx("img",{src:s.srcA,alt:t?.dateA||"Fecha A"}),e.jsx("img",{src:s.srcB,alt:t?.dateB||"Fecha B"})]})}),e.jsx("style",{jsx:!0,children:`
        .mooncouple{ display:grid; gap:.75rem; }
        .mooncouple__controls{ display:grid; grid-template-columns:1fr 1fr; gap:.5rem; align-items:end; }
        .mooncouple__controls label{ display:grid; gap:.25rem; font-weight:600; }
        .mooncouple__grid{ display:grid; grid-template-columns: 1fr 1fr; gap: .75rem; align-items:center; justify-items:center; }
        .mooncard{ display:flex; align-items:center; justify-content:center; padding:.25rem; }
        .mooncouple__match{ text-align:center; margin-top:.25rem; }
        .mooncouple__actions{ display:flex; justify-content:center; margin-top:.25rem; }
        .mooncouple__result{ display:flex; justify-content:center; margin-top:.5rem; }
        .overlay-moon{ position:relative; width:220px; height:220px; border-radius:50%; }
        .overlay-moon img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; border-radius:50%; opacity:.5; box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 2px 8px rgba(255,255,255,.08); background:#0b1020; }
        @media (max-width: 620px){
          .mooncouple__controls{ grid-template-columns:1fr; }
          .mooncouple__grid{ grid-template-columns:1fr; }
        }
      `})]})}function I({messages:t}){const n=()=>{try{const i=(new URL(window.location.href).searchParams.get("mode")||"").toLowerCase();if(i==="single"||i==="one")return"single";if(i==="couple"||i==="two")return"couple"}catch{}return"couple"},[r,a]=l.useState(typeof window>"u"?"couple":n());l.useEffect(()=>{const o=new URL(window.location.href);o.searchParams.set("mode",r),window.history.replaceState({},"",o.toString())},[r]);const u=l.useMemo(()=>({label:t?.modeLabel||"Personas",one:t?.modeOne||"1 persona",two:t?.modeTwo||"2 personas"}),[t]);return e.jsxs("div",{className:"moonswitcher",children:[e.jsxs("div",{className:"moonswitcher__bar",role:"group","aria-label":u.label,children:[e.jsx("button",{type:"button",className:"moonswitcher__btn","data-active":r==="single",onClick:()=>a("single"),"aria-pressed":r==="single",children:u.one}),e.jsx("button",{type:"button",className:"moonswitcher__btn","data-active":r==="couple",onClick:()=>a("couple"),"aria-pressed":r==="couple",children:u.two})]}),e.jsx("div",{className:"moonswitcher__view",children:r==="single"?e.jsx(D,{messages:t}):e.jsx(A,{messages:t})}),e.jsx("style",{children:`
        .moonswitcher{ display:grid; gap:.75rem; }
        .moonswitcher__bar{ display:inline-flex; gap:.35rem; background: rgba(255,255,255,.06); padding:.25rem; border-radius:999px; border:1px solid rgba(255,255,255,.18); width:max-content; }
        .moonswitcher__btn{ border:0; background:transparent; color:inherit; padding:.4rem .8rem; border-radius:999px; cursor:pointer; }
        .moonswitcher__btn[data-active="true"]{ background: var(--accent, #89b4ff); color:#0b1020; font-weight:700; }
      `})]})}export{I as default};
